<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://bootswatch.com/4/lux/bootstrap.min.css">
    <title>React + Spring + Seek</title>
    <style>
        /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
        #map {
            height: 75%;
        }

        .abcRioButton {
            border: 2px solid red;
        }
        .abcRioButtonLightBlue {
            border: 2px solid red;

        }
            /* Optional: Makes the sample page fill the window. */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>




    <div id='root'></div>
    <script src="https://fb.me/react-15.0.1.js"></script>
    <script src="https://fb.me/react-dom-15.0.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <!--<meta name="google-signin-client_id" content="COPY YOUR CLIENT ID HERE">-->
    <meta name="google-signin-client_id"
          content="1038772308568-0sgdg86b8n7thkvcfm61up8ipecfgbgd.apps.googleusercontent.com">

    <script type="text/babel"></script>

    <!--START Google auth Head-->
    <script type="text/javascript">
        var loggedIn = {
            'active': false,
            'provider':null
            };

        function hideSigninElements() {

            document.getElementById("google-signin-element").style.display = "none";
            document.getElementById('fb-login-btn').style.display = 'none';
            document.getElementById("google-signout-btn").setAttribute('style', "visibility:show;");


        }


        function onGoogleSignIn(googleUser) {
            loggedIn.active = true;
            loggedIn.provider = "google";

            console.log(`google onGoogleSignIn function called`,);
            setElements();
            // window.location.href='success.jsp';
            var profile = googleUser.getBasicProfile();
            var imagurl = profile.getImageUrl();
            var name = profile.getName();
            var email = profile.getEmail();
            document.getElementById("google-login-img").src = imagurl;
            document.getElementById("name").innerHTML = name;
            // document.getElementById("google-signin-element").style.display = "none";
            // document.getElementById('fb-login-btn').style.display = 'none';
            // document.getElementById("google-signout-btn").setAttribute('style', "visibility:show;");

            document.getElementById("status").innerHTML = 'Welcome ' + name;
            // document.getElementById("status").innerHTML = 'Welcome ' + name + '!<a href="success.jsp?"+ email = ''+email+' ' & name = '+name+' / > Continue with Google login < /a></p > ';

        }

        function googleLogoutFunction() {
            loggedIn.active = false;
            loggedIn.provider = null;
            gapi.auth2.getAuthInstance().disconnect();
            location.reload();
        }

        window.fbAsyncInit = function () {
            FB.init({
                appId: '2156847117878192',
                cookie: true,
                xfbml: true,
                version: 'v3.0'
            });

            FB.getLoginStatus(function (response) {
                console.log(`RESPONSE from fb:`,response);
                if (response.status === "connected") {
                    loggedIn.active = true;
                    loggedIn.provider = "facebook";
                } else {
                    console.log(`not logged in with fb`,);
                }
                statusChangeCallback(response);
            });

        };

        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {
                return;
            }
            js = d.createElement(s);
            js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

        function checkLoginStatus() {
            return loggedIn.active;
        }

        function statusChangeCallback(response) {
            if (checkLoginStatus()) {
                console.log(`login status was true`,);
                if (response.status === 'connected') {
                    console.log(`facebook connected`,);
                    setElements(true);
                }
                console.log('Logged in and authenticated');
            } else if (response.status === 'connected') {
                console.log(`loggedin status: `,loggedIn.status);
                loggedIn.status = true;
                loggedIn.provider = "facebook";
                console.log(`facebook logged only`,);
                console.log('Logged in and authenticated');
                setElements(true);
            } else {
                console.log('Not authenticated');
                loggedIn.status = false;
                setElements(false);
            }
        }
        function facebookLogout() {
            deleteAllCookies();
            loggedIn.status = false;
            loggedIn.provider = null;
            FB.logout(function (response) {
                setElements(false);

            });
            FB.logout(function(response) {
                FB.Auth.setAuthResponse(null, 'unknown');
                setElements(false);

            });

        }


        function checkLoginState() {
            if (!loggedIn) {
                FB.getLoginStatus(function (response) {
                    statusChangeCallback(response);
                });
            }
        }

    function deleteAllCookies() {
        var cookies = document.cookie.split(";");

        for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i];
            var eqPos = cookie.indexOf("=");
            var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
            document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
        }
    }

        function setElements(isLoggedIn) {

            if (loggedIn.active) {
                console.log(`loggedin is active`,);

                if (loggedIn.provider == "google") {
                    console.log(`provider is google`,);
                    document.getElementById('fb-login-btn').style.display = 'none';
                    document.getElementById('fb-logout-btn').style.display = 'none';
                    document.getElementById('google-signin-element').style.display = 'none';
                    document.getElementById('google-login-img').style.display = 'inline';
                    document.getElementById('google-signout-btn').style.display = 'inline';

                } else if (loggedIn.provider == "facebook") {
                    console.log(`provider is facebook`,);
                    document.getElementById('fb-login-btn').style.display = 'none';
                    document.getElementById('google-login-img').style.display = 'none';
                    document.getElementById('google-signin-element').style.display = 'none';
                    document.getElementById('google-signout-btn').style.display = 'none';
                    document.getElementById('fb-logout-btn').style.display = 'block';

                }

                document.getElementById('map').style.display = 'block';
            } else {
                console.log(`No spoon: FALSE`,);
                document.getElementById('map').style.display = 'none';
                document.getElementById('fb-login-btn').style.display = 'block';
                document.getElementById('fb-logout-btn').style.display = 'none';
                document.getElementById('google-signin-element').style.display = 'inline-block';
                document.getElementById('google-login-img').style.display = 'none';
                document.getElementById('google-signout-btn').style.display = 'none';

            }
        }
    </script>
    <!-- END Facebook Auth -->
</head>
<body>


<nav class="navbar navbar-expand-md navbar-dark bg-dark">
    <a class="navbar-brand" href="#">Navbar</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault"
            aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        <ul class="navbar-nav mr-auto">
            <li>
                <a class="nav-link" href="loggedInPage.html">Home <span class="sr-only">(current)</span></a>
            </li>
        </ul>
        <ul class="nav nvabar-nav navbar-right">
            <li>
                <!--START Google AUTH-->
                <div class="g-signin2" data-onsuccess="onGoogleSignIn" style="{height: 24px; width: 93px; background-color: cornflowerblue}" id="google-signin-element"></div>
                <img id="google-login-img" style="{height: 24px; width: 93px; background-color: cornflowerblue}"><br>
                <p id="name"></p>

                <div id="status">
                </div>

                <button onclick="googleLogoutFunction()" id="google-signout-btn" >Sign Out</button>

                <!--END GOOGLE AUTH-->

            </li>
            <li>
                <!--<a href="/logout.html" onclick="facebookLogout()" id="fb-logout-btn" class="alert-danger">Logout</a>-->
                <a href="/logout.html" onclick="facebookLogout()" id="fb-logout-btn" class="alert-danger">Logout</a>
            </li>
            <li>
                <fb:login-button
                        id="fb-login-btn"
                        scope="public_profile,email"
                        onlogin="checkLoginState();">
                </fb:login-button>
            </li>
        </ul>
    </div>
</nav>
<h1>main seek page</h1>
<div id="map"></div>
<script>

    //todo: add GET call to REST route on server to get places

    var places = [{
        lat: 47.612049,
        lng: -122.337432,
        name: 'Westlake Center',
    }, {
        lat: 47.598036,
        lng: -122.324956,
        name: 'Seattle Pinball Museum',
    }, {
        lat: 47.591403,
        lng: -122.332509,
        name: 'Safeco Stadium',
    }, {
        lat: 47.655335,
        lng: -122.303520,
        name: 'University Of Washington',
    }]
    var map;

    //Define the map function
    function initMap() {
        var uluru = {lat: 47.6098114, lng: -122.19656910000003};
        var notuluru = {lat: 47.615544, lng: -122.203845};
        var fave_city = uluru;
        //Initialize the map
        map = new google.maps.Map(document.getElementById('map'), {
            //todo: set the start location to their favorite city or something
            // center: {lat: 47.6098114, lng: -122.19656910000003},
            center: fave_city,
            zoom: 8
        });

        places.forEach(function (element) {
            var location = {lat: element.lat, lng: element.lng};
            var custommarker = new google.maps.Marker({position: location, map: map, label: element.name});
            console.log(custommarker);
            console.log(location);
            console.log(element);
        });
        var marker = new google.maps.Marker({position: uluru, map: map, label: 'Coding Dojo'});
        var marker1 = new google.maps.Marker({position: notuluru, map: map, label: 'Bellevue Square'});
    }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD86xjRo8z7-xUgW2HgsVJv6-6MWhDOWz4&callback=initMap"
        async defer></script>


</body>
</html>